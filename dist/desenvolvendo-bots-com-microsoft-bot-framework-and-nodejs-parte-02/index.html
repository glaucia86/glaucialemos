<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <title>Desenvolvendo Bots com Microsoft Bot Framework &amp; Node.Js – Parte 02 // Glaucia Lemos</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="HandheldFriendly" content="true" />

    <link rel="shortcut icon" href="/code.ico" type="image/x-icon">

    <link rel="stylesheet" href="/css/main.css" />
    <link rel="stylesheet" href="/css/highlight.css" />
    <link rel="stylesheet" href="/css/senna.css" />

    <script src="/js/senna.min.js"></script>
    <script src="/js/headroom.min.js"></script>
    <script src="/js/main.js"></script>

    <!-- Inspectlet -->
    <script>
      window.__insp = window.__insp || [];
      __insp.push(['wid', 772378335]);
      (function () {
        function __ldinsp() {
          const insp = document.createElement('script');
          insp.type = 'text/javascript';
          insp.async = true;
          insp.id = 'inspsync';
          insp.src = `${document.location.protocol == 'https:' ? 'https' : 'http'
    }://cdn.inspectlet.com/inspectlet.js`;
          const x = document.getElementsByTagName('script')[0];
          x.parentNode.insertBefore(insp, x);
        }
        if (window.attachEvent) {
          window.attachEvent('onload', __ldinsp);
        } else {
          window.addEventListener('load', __ldinsp, false);
        }
      }());
    </script>

    <!-- Google Analytics -->
    <script>
      (function (i, s, o, g, r, a, m) {
        i.GoogleAnalyticsObject = r;
        (i[r] = i[r]
    || function () {
            (i[r].q = i[r].q || []).push(arguments);
          }),
        (i[r].l = 1 * new Date());
        (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m);
      }(
  window,
  document,
  'script',
  '//www.google-analytics.com/analytics.js',
  'ga',
));
      ga('create', 'UA-4114546-2', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
  <body data-senna data-senna-surface>
    <div class="senna-loading-bar"></div>

    <header class="site-header site-header-white">
      <a href="/" class="logo">Glaucia Lemos</a>
    
      <nav class="site-nav">
        <ul>
          <li><a href="/articles/">Artigos</a></li>
          <li><a href="/resume/">Currículo</a></li>
          <li><a href="/talks/">Palestras</a></li>
          <li><a href="/projects/">Projetos Pessoais</a></li>
          <li><a href="/about/">Sobre Mim</a></li>
          <li><a href="/thoughts/">Pensamentos</a></li>
          <li><a href="/contact/">Entre em Contato</a></li>
        </ul>
      </nav>
    
      <div class="nav-social">
        <a href="https://github.com/glaucia86" title="GitHub">
          <svg viewBox="0 0 512 512">
            <path
              d="M256 70.7c-102.6 0-185.9 83.2-185.9 185.9 0 82.1 53.3 151.8 127.1 176.4 9.3 1.7 12.3-4 12.3-8.9V389.4c-51.7 11.3-62.5-21.9-62.5-21.9 -8.4-21.5-20.6-27.2-20.6-27.2 -16.9-11.5 1.3-11.3 1.3-11.3 18.7 1.3 28.5 19.2 28.5 19.2 16.6 28.4 43.5 20.2 54.1 15.4 1.7-12 6.5-20.2 11.8-24.9 -41.3-4.7-84.7-20.6-84.7-91.9 0-20.3 7.3-36.9 19.2-49.9 -1.9-4.7-8.3-23.6 1.8-49.2 0 0 15.6-5 51.1 19.1 14.8-4.1 30.7-6.2 46.5-6.3 15.8 0.1 31.7 2.1 46.6 6.3 35.5-24 51.1-19.1 51.1-19.1 10.1 25.6 3.8 44.5 1.8 49.2 11.9 13 19.1 29.6 19.1 49.9 0 71.4-43.5 87.1-84.9 91.7 6.7 5.8 12.8 17.1 12.8 34.4 0 24.9 0 44.9 0 51 0 4.9 3 10.7 12.4 8.9 73.8-24.6 127-94.3 127-176.4C441.9 153.9 358.6 70.7 256 70.7z"
            ></path>
          </svg>
        </a>
      </div>
    </header>
  </body>
</html>

<main class="post">
  <div class="post-content post-article">
    <div class="post-container">
      <h1 class="post-title">Desenvolvendo Bots com Microsoft Bot Framework &amp; Node.Js – Parte 02</h1>
      <h2 class="post-subtitle">May 11, 2018</h2>
       <p>Fala, pessoal! Tudo bem?</p>
<p>
  Conforme falado no último artigo, daremos continuidade a sequência de artigos que abordam o desenvolvimento de bots usando o Microsoft Bot Framework & Node.js.
</p>

<p>
  Nesta segunda parte falaremos sobre o uso de ‘Dialogs’, um dos conceitos chave e mais importantes quando se desenvolve um determinado ChatBot.
</p>

<p>E aí? Vamos embarcar na segunda parte?</p>
<p align="center">
  <img src="https://static.imasters.com.br/wp-content/uploads/2018/05/image1.jpg"/>  
</p>

<h2 id="o-que-são-dialogs">O que são Dialogs?</h2>
<p>
  Assim como no mundo real precisamos ‘dialogar’ com as pessoas para obter uma determinada informação, o mesmo se passa com um Bot.
</p>

<p>
  Porém, no conceito de Bots, ‘dialogs’ nos permitem gerenciar um determinado fluxo de conversação, que nesse caso será entre o Bot com o usuário. E essas conversas são organizadas por ‘dialogs’. Pois é justamente através de um dialog que o seu Bot irá interagir com o usuário.
</p>

<p>
  E uma das características mais importantes do dialogs são as cascatas de conversação (waterfalls), que seriam uma alternação de diálogos em resposta ao usuário com o Bot. Quando vocês forem analisar os blocos de código de exemplo,observarão que esses waterfalls de dialogs são pequenas funções que têm como objetivo retornar de maneira satisfatória alguma resposta ou informação determinada para o usuário. Por isso que, dentro do mundo dos Bots, saber e entender bem o fluxo de conversação é de suma importância para quem está desenvolvendo um ChatBot.
</p>

<p>Através deles, poderemos:</p>
<ul>
<li>Executar e gerenciar fluxos de conversação: sendo elas simples ou complexas;</li>
<li>Manipular esses fluxos de maneira encadeada ou arrays;</li>
<li>E podemos criar fluxos de 2 maneiras (uma delas já ditas acima): via prompt ou via waterfall – a qual pertencem ao SDK do Bot Builder para Node.js;</li>
</ul>
<h2 id="beleza-mas-o-que-são-waterfalls--prompts">Beleza! Mas o que são Waterfalls &amp; Prompts?</h2>
<p>Waterfall (cascata) auxilia a criar um determinado modelo de fluxo de conversação do Bot. Como o próprio nome já diz, quando criamos blocos de cascata, por consequência criamos uma sequência de passos de fluxo de conversação do nosso Bot.</p>
<p>Já os <b>prompts</b>, nada mais são do que as ações contidas nesses fluxos que serão concedidas através do usuário. Quando começarmos a escrever algum bloco de código aqui, essas duas definições ficarão mais simples para todos vocês!</p>
<p align="center">
  <img src="https://static.imasters.com.br/wp-content/uploads/2018/05/image3.jpg"/>  
</p>

<p>Os principais métodos mais usados num fluxo de conversação de um Bot, são:</p>
<ul>
<li>beginDialog</li>
<li>endDialog</li>
<li>endDialogWithResults</li>
<li>replaceDialog</li>
<li>cancelDialog</li>
<li>endConversation</li>
</ul>
<p>
  Caso queiram obter mais informações a respeito desses métodos, não deixem de olhar a documentação do SDK do Bot Builder (Node.Js) <b><a href="https://docs.microsoft.com/en-us/azure/bot-service/?view=azure-bot-service-3.0">neste link(v.3)</a></b>. Recomendo darem uma olhada, uma vez que para todo programador a documentação de um SDK é como um dicionário da língua portuguesa. Caso queiramos entender e compreender o que estamos escrevendo, precisamos entender melhor o que cada coisa faz. #ficaadica
</p>

<h2 id="okay-bora-codar">Okay! Bora codar?</h2>
<p>
  Sim, claro! Tudo fica mais fácil quando programamos. Abram o VS Code de vocês e escrevam as linhas de código logo abaixo. Em seguida explicarei o que é cada coisa.
</p>


<pre><code class="hljs javascript"><span class="hljs-comment">/** * * Arquivo: olaMundoBot.js * Data: 23/04/2018 * Descrição: Desenvolvimento de um Bot via Bot Emulator. * Author: Glaucia Lemos * * */</span>
<span class="hljs-keyword">var</span> restify = <span class="hljs-built_in">require</span>(<span class="hljs-string">'restify'</span>);
<span class="hljs-keyword">var</span> builder = <span class="hljs-built_in">require</span>(<span class="hljs-string">'botbuilder'</span>); <span class="hljs-comment">// Configuração do Server via Restify: </span>
<span class="hljs-keyword">var</span> server = restify.createServer();

server.listen(process.env.port || process.env.PORT || <span class="hljs-number">3978</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'%s Aplicação está executando na porta %s'</span>, server.name, server.url);
});

<span class="hljs-comment">// Criação do chat connector para comunicar com o serviço do Bot Framework: </span>
<span class="hljs-keyword">var</span> connector = <span class="hljs-keyword">new</span> builder.ChatConnector({
  <span class="hljs-attr">appId</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">appPassword</span>: <span class="hljs-string">''</span>
});

<span class="hljs-comment">//Endpoint para executar as mensagens para os usuários via Bot Emulator: </span>
server.post(<span class="hljs-string">"/api/messages"</span>, connector.listen());

<span class="hljs-keyword">const</span> bot = <span class="hljs-keyword">new</span> builder.UniversalBot(connector);

<span class="hljs-comment">// Bloco de Dialogs: </span>
bot.dialog(<span class="hljs-string">"/"</span>, [<span class="hljs-function"><span class="hljs-params">session</span> =&gt;</span> {
  builder.Prompts.text(session, <span class="hljs-string">"Oi! Como você se chama?"</span>);
}, (session, results) =&gt; {
  <span class="hljs-keyword">let</span> nome = results.response;
  session.send(<span class="hljs-string">`Oi! <span class="hljs-subst">${nome}</span>`</span>);
  session.beginDialog(<span class="hljs-string">"/perguntarPratoPredileto"</span>);
}]);

bot.dialog(<span class="hljs-string">"/perguntarPratoPredileto"</span>, [<span class="hljs-function"><span class="hljs-params">session</span> =&gt;</span> {
  builder.Prompts.text(session, <span class="hljs-string">"Qual é o seu prato predileto?"</span>);
}, (session, results) =&gt; {
  <span class="hljs-keyword">let</span> pratoPredileto = results.response;
   session.endDialog(<span class="hljs-string">`Puxa que legal! Então você gosta de comer **<span class="hljs-subst">${pratoPredileto}</span>**!`</span>);
  session.beginDialog(<span class="hljs-string">"/perguntarLugarPreferido"</span>);
}]);

bot.dialog(<span class="hljs-string">"/perguntarLugarPreferido"</span>, [<span class="hljs-function"><span class="hljs-params">session</span> =&gt;</span> {
  builder.Prompts.text(session, <span class="hljs-string">"Qual é o seu lugar preferido?"</span>);
}, (session, results) =&gt; {
  <span class="hljs-keyword">let</span> lugar = results.response;
   session.endDialog(<span class="hljs-string">`Amamos **<span class="hljs-subst">${lugar}</span>**! É simplesmente um lugar muito bonito!`</span>);
}]);</code></pre>

<p>
  Vamos entender alguns pontos antes de testarmos esse nosso bot. Notem que, das linhas 30 a 62 já estamos trabalhando com o conceito de waterfalls em nosso fluxo de conversação. Outros pontos muito interessantes a serem observados, são:
</p>

<p>
  A cada novo fluxo criado, criamos um ‘bot.dialog(‘/)’
  Todas as vezes que o usuário precisa responder algo ao ChatBot, usamos os Prompts.
  Nas linhas 41, 54 e 65 estamos usando os métodos já explicados acima: beginDialog e endDialog. Por que estamos usando? Porque estamos trabalhando com fluxos de conversação. E toda conversa precisa ter início e fim!
</p>

<p>
  Vamos executar esse código? Para isso, abram o emulator e vejam o resultado – lembrando que antes precisamos executar o nodemon e o arquivo criado!
</p>

<p align="center">
  <img src="https://static.imasters.com.br/wp-content/uploads/2018/05/rd-1.jpg"/>  
</p>

<p>Agora, sim, podemos executar o Emulator!</p>
<p align="center">
  <img src="https://static.imasters.com.br/wp-content/uploads/2018/05/cre.jpg"/>  
</p>

<p>
  Lindo, não é mesmo? Notem como fica mais fluido o fluxo de conversação do nosso ChatBot! Há muitas outras coisas envolvidas nessa parte do Bot! Caso queiram se inteirar mais a respeito desse assunto, peço que deem uma olhada nos vídeos que ando fazendo sobre o assunto – especialmente as aulas 09 a 11 <b><a href="https://www.youtube.com/watch?v=-pB48tj_9_w">AQUI</a></b>:
</p>

<h2 id="palavras-finais">Palavras finais</h2>
<p>
  Como falado acima, há muita coisa que podemos aproveitar no fluxo de diálogos dentro de um ChatBot, tornando ele mais fluído e especialmente mais interativo com o nosso usuário final. Peço que deem uma olhada na documentação da Microsoft neste link, e nas vídeo aulas que estou fazendo sobre o assunto.
</p>

<p>
  No próximo artigo falarei sobre o uso do LUIS. Um serviço cognitivo da Microsoft, que deixará o nosso ChatBot mais inteligente! Nos vemos, pessoal! Até a próxima! 😄😄
</p>



    </div>
  </div>
</main>

</body>
</html>
